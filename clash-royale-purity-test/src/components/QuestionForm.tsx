import { useState } from "react";
import { useNavigate } from "react-router-dom";
import questions from "../data/questions.json";

interface Question {
  id: number;
  text: string;
}

export default function QuestionForm() {
  const navigate = useNavigate();

  // Store checkbox state: id â†’ boolean
  const [answers, setAnswers] = useState<Record<number, boolean>>({});

  const handleToggle = (id: number) => {
    setAnswers((prev) => ({
      ...prev,
      [id]: !prev[id],
    }));
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    const total = questions.length;
    const checkedCount = Object.values(answers).filter((v) => v).length;

    // Classic Rice Purity Calculation
    const purityScore = Math.round(100 - (checkedCount / total) * 100);

    navigate(`/score?score=${purityScore}`);
  };

  return (
    <div className="min-h-screen bg-slate-800 bg-opacity-95 flex items-center justify-center px-4 py-8" style={{
      backgroundImage: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1024 1024'%3E%3Cpath fill='%23334155' opacity='0.1' d='M890.234863,540.987915C889.191711,574.281372 888.171997,607.078430 887.112671,639.874207C886.091003,671.503418 885.052307,703.131958 883.973572,734.759216C883.462585,749.739502 882.945251,764.721008 882.230652,779.692383C881.792542,788.870605 877.010742,795.213074 868.717041,799.082825C852.416016,806.688660 836.146973,814.363098 819.873718,822.028137C769.544006,845.734436 719.226685,869.466858 668.889160,893.156616C620.058777,916.137085 571.209961,939.078491 522.367920,962.034241C515.729919,965.154053 509.290192,964.727051 502.661285,961.597229C432.315338,928.383362 361.925690,895.261963 291.548737,862.113647C247.094910,841.175415 202.666809,820.182373 158.169998,799.335938C148.328903,794.725403 143.830124,787.394653 143.584000,776.496704C142.824356,742.859497 141.883118,709.222046 140.532028,675.604004C139.395065,647.313843 138.359344,619.024597 137.597595,590.721863C136.737137,558.752563 135.893005,526.778809 134.549988,494.827667C133.388916,467.205170 132.427780,439.579742 131.615143,411.946411C130.675110,379.981323 129.920609,348.007050 128.562378,316.058990C126.885689,276.620117 125.640549,237.171661 124.488174,197.716156C124.181816,187.226685 123.647652,176.741333 123.624802,166.243301C123.593925,152.064255 132.034302,143.704453 146.387543,143.702515C222.384567,143.692261 298.381714,143.639359 374.378357,143.812820C380.100800,143.825882 384.384857,142.240311 388.739716,138.580658C424.837219,108.245872 461.097260,78.104317 497.342865,47.946083C508.043274,39.042782 518.163330,39.109447 528.890564,48.055775C565.485962,78.575859 602.092407,109.082878 638.593506,139.715454C642.005676,142.579102 645.411865,143.784500 649.864929,143.778152C726.528442,143.668808 803.192139,143.718292 879.855835,143.686676C889.645447,143.682632 896.869446,147.632782 901.019531,156.669907C901.856262,158.492020 902.348083,160.418625 902.349304,162.470490C902.363098,185.467178 901.392639,208.438065 900.500000,231.409439C900.099121,241.727554 899.938232,252.050110 899.470764,262.370941C898.355591,286.990112 897.907349,311.639099 897.133728,336.274292C896.156189,367.405334 895.147095,398.535400 894.107056,429.664398C893.156189,458.123413 892.315308,486.587921 891.058228,515.033752C890.683105,523.520874 890.407532,532.001648 890.234863,540.987915M169.355988,291.236786C169.601547,294.053833 169.976974,296.866455 170.072754,299.688568C171.151657,331.475983 172.188431,363.264801 173.234741,395.053314C173.853790,413.860992 174.455490,432.669281 175.089920,451.476440C176.454178,491.918030 177.840485,532.358948 179.206268,572.800476C180.172989,601.425842 181.136108,630.051453 182.073120,658.677795C183.151840,691.633362 184.392517,724.585938 185.086975,757.549744C185.214462,763.601685 187.017761,766.559998 192.523300,769.118164C241.464417,791.859009 290.247833,814.939209 339.083649,837.906860C396.057556,864.701965 453.042633,891.473206 509.994507,918.315002C512.169617,919.340149 513.881653,919.320557 516.063904,918.285828C539.841187,907.010681 563.673767,895.852173 587.487732,884.654297C635.120178,862.256531 682.749573,839.852295 730.381592,817.453613C765.503296,800.937988 800.609253,784.388184 835.778809,767.974854C839.250549,766.354553 840.818359,764.345581 840.777222,760.397766C840.688904,751.909607 841.251282,743.420837 841.537170,734.936279C842.473694,707.146973 843.631592,679.365051 844.524414,651.577026C845.562134,619.281799 846.440430,586.981445 847.595154,554.688354C848.565002,527.567871 849.579956,500.448212 850.505554,473.328125C851.619080,440.703186 852.477295,408.067810 853.603271,375.440552C854.544861,348.153137 855.416809,320.865387 856.526611,293.582611C857.873657,260.469421 858.671875,227.333618 859.644775,194.205750C859.884766,186.031982 859.773071,186.022476 851.532288,186.025330C781.042664,186.049744 710.552917,186.011673 640.063721,186.190933C631.921814,186.211624 625.314026,183.749741 619.113159,178.532776C585.838318,150.537781 552.393433,122.744881 519.000122,94.890709C512.885132,89.790039 512.944458,89.897324 506.805969,95.026451C472.807587,123.434410 438.754150,151.776489 404.762817,180.192810C399.643463,184.472549 393.921082,186.183685 387.261139,186.171692C317.104980,186.045349 246.948593,186.046310 176.792267,186.034531C165.138870,186.032578 166.099136,184.761185 166.453857,196.890533C167.364319,228.022934 168.375320,259.152405 169.355988,291.236786Z'/%3E%3C/svg%3E")`,
      backgroundSize: '200px 200px',
      backgroundRepeat: 'repeat',
      backgroundAttachment: 'fixed'
    }}>
      <div className="max-w-3xl w-full">
        <h1 className="text-3xl font-bold mb-6 text-center text-white">
          Clash Royale Purity Test
        </h1>

        <form
          onSubmit={handleSubmit}
          className="space-y-4 bg-slate-700 bg-opacity-60 shadow-lg rounded-xl p-6"
        >
        <div className="space-y-3 max-h-[70vh] overflow-y-auto pr-2">
          {(questions as Question[]).map((q) => (
            <label
              key={q.id}
              className="flex items-start space-x-3 cursor-pointer"
            >
              <input
                type="checkbox"
                className="mt-1 h-5 w-5 rounded border-slate-400"
                checked={!!answers[q.id]}
                onChange={() => handleToggle(q.id)}
              />
              <span className="text-slate-100 leading-tight">{q.text}</span>
            </label>
          ))}
        </div>

        <button
          type="submit"
          className="w-full bg-blue-600 text-white py-3 rounded-lg text-lg font-semibold hover:bg-blue-700 transition"
        >
          Submit
        </button>
      </form>
      </div>
    </div>
  );
}
